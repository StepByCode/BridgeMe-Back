
# 開発者向け仕様書

本文書は、`BridgeMe-Back` プロジェクトの開発者を対象とした技術的な仕様や規約をまとめたものです。

## 1. 概要

このプロジェクトは、NFCキーホルダーをスマートフォンにかざすだけで、プロフィールをウェブブラウザに表示するシンプルなサービスです。バックエンドはGo言語で実装されており、クリーンアーキテクチャの原則に従っています。

## 2. 技術スタック

- **言語:** Go
- **データベース:** MongoDB
- **Webフレームワーク/ルーティング:** `gorilla/mux`
- **バリデーション:** `go-playground/validator`
- **テスティング:** Go標準 `testing` パッケージ, `stretchr/testify` (assert, mock)
- **CI/CD:** GitHub Actions

## 3. アーキテクチャ

本プロジェクトはクリーンアーキテクチャを採用しており、関心の分離を徹底しています。

- `domain`: ビジネスのコアとなるエンティティ（例: `Profile` 構造体）を定義します。他のどのレイヤーにも依存しません。
- `usecase`: アプリケーション固有のビジネスロジックを実装します。`domain` 層にのみ依存します。
- `interfaces`: 外部との通信を担当します。HTTPリクエストを処理する `controllers` や、データベース操作を実装する `repositories` が含まれます。
- `infrastructure`: データベース接続など、具体的な技術に依存する低レベルな実装を担当します。

依存関係の方向は、必ず `interfaces` -> `usecase` -> `domain` となります。

## 4. 開発環境のセットアップ

詳細なセットアップ手順は、プロジェクトルートの `README.md` を参照してください。

## 5. APIエンドポイント

| メソッド | パス           | 説明           |
| :------- | :------------- | :------------- |
| `POST`   | `/profiles`    | プロフィールの作成 |
| `GET`    | `/profiles/{id}` | 特定のプロフィールを取得 |
| `GET`    | `/profiles`    | 全てのプロフィールを取得 |

### バリデーションルール

`POST /profiles` のリクエストボディに対して、以下のバリデーションが適用されます。

- `name`: 必須項目 (required)
- `affiliation`: 必須項目 (required)
- `bio`: 必須項目 (required)

## 6. テスティング

品質を担保するため、ユニットテストを規約とします。

### 方針

- **ユニットテスト**: 各層が持つべき責務に集中するため、依存する層はモック（偽物）に置き換えてテストを記述します。
  - **usecase層**: Repositoryをモック化し、ビジネスロジックが正しいかをテストします。
  - **interfaces/controllers層**: Usecaseをモック化し、HTTPリクエストのハンドリングが正しいかをテストします。
- **DB非依存**: ユニットテストはデータベース等の外部環境に接続せず、完全に独立して実行可能であるべきです。

### 実行方法

プロジェクトのルートディレクトリで以下のコマンドを実行すると、全てのテストが実行されます。

```bash
go test -v ./...
```

### CI/CD

`.github/workflows/ci.yml` にて、`main` ブランチへの `push` 及び `pull_request` をトリガーとして、全てのテストが自動実行されるように設定されています。

## 7. 依存関係の管理

本プロジェクトは Go Modules を使用して依存関係を管理しています。新しい外部パッケージを追加した際は、以下のコマンドを実行して `go.mod` 及び `go.sum` を更新してください。

```bash
go mod tidy
```
